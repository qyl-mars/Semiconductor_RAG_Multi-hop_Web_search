import re

def clean_text(text):
    """清理文本中的非法字符，控制文本长度"""
    if not text:
        return ""
    # 移除控制字符，保留换行和制表符
    text = re.sub(r'[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]', '', text)
    # 移除重复的空白字符
    # \s+ 匹配一个或多个空格、换行、制表符，并将其统一替换成一个空格
    # 警惕：\s+ 可能会杀掉表格结构。 如果半导体手册里有很多复杂的参数对比表，\s+ 会把原本分行的表格数据全部“揉”成一坨
    text = re.sub(r'\s+', ' ', text)
    # 确保文本长度在合理范围内

    # 针对目录的...........，
    text = re.sub(r'\.\.\.+', ' ', text)
    return text.strip()


"""
正则清洗逻辑：text = re.sub(r'[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]', '', text)

原理：利用 ASCII 十六进制范围，除了换行（\n）、回车（\r）和制表符（\t）,精准剔除 0-31 号段中其他的所有控制字符。

目的：净化 PDF 解析后的原始文本，去除不可见噪音，提升 Token 利用率和模型理解精度。


"""
